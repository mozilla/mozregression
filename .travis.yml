os:
  - linux
  - osx

install:
    - if [ "$TRAVIS_OS_NAME" == "linux" ]; then
          export DISPLAY=:99.0;
          sh -e /etc/init.d/xvfb start;
          sudo apt-get update -qq;
          sudo apt-get install python-qt4 pyqt4-dev-tools;
      fi
    - if [ "$TRAVIS_OS_NAME" == "osx" ]; then
          brew update; brew outdated xctool || brew upgrade xctool;
          pip install virtualenv;
          brew install pyqt;
          brew linkapps qt;
          MOZPATH="$PWD";
          mkdir -p /Users/travis/Library/Python/2.7/lib/python/site-packages;
          echo 'import site; site.addsitedir("/usr/local/lib/python2.7/site-packages")' >> /Users/travis/Library/Python/2.7/lib/python/site-packages/homebrew.pth;
          export PYTHONPATH=/usr/local/lib/python2.7/site-packages:$PYTHONPATH;
          cd /usr/local/opt/pyqt/lib/python2.7/site-packages/PyQt4;
          sudo install_name_tool -id $PWD/QtCore.so QtCore.so;
          sudo install_name_tool -id $PWD/QtGui.so QtGui.so;
          cd $MOZPATH;
      fi
    - virtualenv --system-site-packages venv
    - source venv/bin/activate
    - pip install -r  requirements-gui-dev.txt

script:
  - if [ "$TRAVIS_OS_NAME" == "linux" ]; then ./check.py --with-coverage --with-gui; fi
  - if [ "$TRAVIS_OS_NAME" == "osx" ]; then ./check.py --with-gui; fi

after_success:
    - if [ "$TRAVIS_OS_NAME" == "linux" ]; then pip install coveralls; coveralls; fi


before_deploy:
    - python gui/build.py bundle

deploy:
  - provider: releases
    api-key:
       secure: Fk4W2VGIKVdTnrqn984BgU5VWjHs9oQ/0ZHkld+dkjtJ3dHJ0aG8UXlXKEK5OcOCQjvHGyS+zeVuJwktCvZYw2J36YItNQZ5fDTIIpv5Zb8ZX9dD2XsOkR1urrHqiplyGMVwaGNQdtbZlkTxg6f28Jw+Rs/8f4ciCdEmGWmnSvds/WWGwzI+tqI53hK5j3wHJxVQI/aifYFdLFmsOt/G2X4R/KpyzON9rX53B27pd7hrLFbN8VM+n4xtEidLPXa6NHAEX03J0CmdnJkURHQxObDmwyk6aC2evurtmuZ6GxgOyo8QWXx7YJZBZPGUasB+SGLazQlnHXuywK77UR9luSFq+uLfJLFeP6JEU30sBP3TNxFOFJCtsUaX8IFM5GtS8pkRtT+hf//+X3pIouBoBOx3sBBGAAxmlV6bzlWXjXZOr1KAvXFyTsuhI2PXExGH725NiBlV9asVlkbJt7t5zHi9WZLLRMx5D5rq68NOWdyhIZAVVa4lQaAQxLpK2Fj3RRQvzwHqiZtESTdfwWjL9hkxO9IKhQmNuxRvEOnwLqDKB/K7badVKRasq886gs5AueI4dBrP7MdjDKtBpjweDQUjpJ3VaJFocJ1vNezm104AOYPVA9llDffu+2hlHIC3hNQ5GC3htSg4iJZtLKHAMRd/JS3ZhJfmstICrFzsUA4=
    file: gui/dist/mozregression-gui.dmg
    skip_cleanup: true
    on:
      tags: true
      condition:
        - $TRAVIS_OS_NAME == osx

  - provider: releases
    api-key:
       secure: Fk4W2VGIKVdTnrqn984BgU5VWjHs9oQ/0ZHkld+dkjtJ3dHJ0aG8UXlXKEK5OcOCQjvHGyS+zeVuJwktCvZYw2J36YItNQZ5fDTIIpv5Zb8ZX9dD2XsOkR1urrHqiplyGMVwaGNQdtbZlkTxg6f28Jw+Rs/8f4ciCdEmGWmnSvds/WWGwzI+tqI53hK5j3wHJxVQI/aifYFdLFmsOt/G2X4R/KpyzON9rX53B27pd7hrLFbN8VM+n4xtEidLPXa6NHAEX03J0CmdnJkURHQxObDmwyk6aC2evurtmuZ6GxgOyo8QWXx7YJZBZPGUasB+SGLazQlnHXuywK77UR9luSFq+uLfJLFeP6JEU30sBP3TNxFOFJCtsUaX8IFM5GtS8pkRtT+hf//+X3pIouBoBOx3sBBGAAxmlV6bzlWXjXZOr1KAvXFyTsuhI2PXExGH725NiBlV9asVlkbJt7t5zHi9WZLLRMx5D5rq68NOWdyhIZAVVa4lQaAQxLpK2Fj3RRQvzwHqiZtESTdfwWjL9hkxO9IKhQmNuxRvEOnwLqDKB/K7badVKRasq886gs5AueI4dBrP7MdjDKtBpjweDQUjpJ3VaJFocJ1vNezm104AOYPVA9llDffu+2hlHIC3hNQ5GC3htSg4iJZtLKHAMRd/JS3ZhJfmstICrFzsUA4=
    file: gui/mozregression-gui.tar.gz
    skip_cleanup: true
    on:
      tags: true
      condition:
        - $TRAVIS_OS_NAME == linux